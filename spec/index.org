#+title: Carriage-mode Spec Index (v1)
#+author: Peter Kosov <11111000000@email.com>
#+language: ru
#+options: toc:2 num:t
#+property: header-args :results silent

* FREEZE (v1)
  - DELIM: ровно 6 hex в нижнем регистре ([0-9a-f]{6}); Emacs regexp якорями: "\`[0-9a-f]\{6\}\'" (в строках Elisp: "\\`[0-9a-f]\\{6\\}\\'"); инструмент генерирует случайный токен.
  - Макс. пар в SRE-batch: 200 (превышение → SRE_E_LIMITS)
  - Макс. сегмент FROM/TO: 512 KiB
  - Макс. размер тела ответа: 4 MiB
  - Тайм-аут git: 15 сек.
  - Пути: только относительные, внутри корня проекта; symlink — deny escape.
  - SRE: only :occur first|all, :expect обязателен для all.
  - Patch: только один файл на блок; :strip=1 по умолчанию (a/ b/ префиксы обязательны).
  - TRAMP и бинарные патчи — не поддерживаются.

* Источники истины (anchors)
- Имя спец-блока (=begin_patch/end_patch=): ./parser-registry-v1.org.
- FREEZE/лимиты/DELIM: ./index.org (секция FREEZE).
- Политика путей, symlink, TRAMP: ./security-v1.org.
- Конвейер применения и dry-run/подтверждение: ./apply-pipeline-v1.org.
- Движки применения (Apply Engines): ./apply-engines-v1.org.
- Правила unified diff: ./patch-unified-diff-v1.org.
- Операции create/delete/rename: ./file-ops-v1.org.
- Формат SRE/SRE-BATCH: ./sre-v1.org.
- UI/состояния/таблицы: ./ui-v1.org.
- Git/WIP: ./git-integration-v1.org.
- Коды ошибок: ./errors-v1.org.
- Структуры данных: ./data-structures-v1.org.
- Реестр и имплементация парсеров: ./parser-registry-v1.org, ./parser-impl-v1.org.
- Неблокирующий пролог и Abort: ./async-workflow-v1.org.

* Назначение
- Этот индекс собирает спецификации форматов и самого мода.
- Версия сводной спецификации: v1 (минимальная, надёжная, без алиасов).

* Состав
- Форматы патчей:
  - ./sre-v1.org — Search/Replace формат (sre, sre-batch) в блоке =patch=.
  - ./patch-unified-diff-v1.org — Unified Diff в блоке =patch=.
  - ./file-ops-v1.org — Операции над файлами (create, delete, rename) в блоках =patch=.
- Спецификация мода (основы и модули):
  - ./carriage-mode-v1.org — основы мода, активация, команды, поведение.
  - ./llm-transport-v1.org — абстракция транспорта LLM/агентов и адаптер к gptel (референс).
  - ./project-structure-v1.org — структура проекта, слои и зависимости.
  - ./extensibility-points-v1.org — точки расширения (ops, транспорты, UI).
  - ./parser-registry-v1.org — диспетчеризация (:version,:op) → парсер/апплаер.
  - ./apply-engines-v1.org — абстракция движков применения (реестр, контракты).
  - ./apply-pipeline-v1.org — Dry-run, применение, атомарность, порядок.
  - ./git-integration-v1.org — Git, ветка WIP, безопасность путей.
  - ./security-v1.org — политики безопасности и ограничения.
  - ./prompt-profiles-v1.org — Intent/Suite: реестр сьюитов и композиция промптов по ops.
  - ./ui-v1.org — header-line, mode-line, keymap, буферы отчётов.
  - ./errors-v1.org — коды ошибок и формат диагностики.
  - ./testing-v1.org — план тестов ERT/интеграция.
  - ./data-structures-v1.org — единые структуры плана, отчётов и диагностики.
  - ./parser-impl-v1.org — контракты parse/dry-run/apply и elisp-скелеты.
  - ./api-v1.org — публичный API: команды, переменные, лица.
  - ./compliance-checklist-v1.org — контрольный список соответствия.
- Нарратив и основания:
  - ./carriage-whitepaper-v1.org — философия, мотивация и архитектурные решения без детализации реализации.

* Инварианты v1
- Блоки форматов используют имя =patch=:
  - #+begin_patch (<plist>) ... #+end_patch
- Алиасы не поддерживаются в v1.
- Один блок = одна операция над одним целевым объектом (обычно файл).
- Для SRE-batch — один блок на один файл, несколько пар FROM→TO. DELIM: ровно 6 hex
- Для Unified Diff — ровно один файл на блок.
