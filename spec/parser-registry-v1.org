#+title: Parser Registry v1
#+author: Peter Kosov <11111000000@email.com>
#+language: ru
#+options: toc:2 num:t

* Назначение
- Единая таблица сопоставления (:version, :op) → parse/dry-run/apply + prompt-fragment.
- Централизованное правило имени блока: используется только =patch=.

* Имя спец-блока
- Норматив: использовать и принимать только =begin_patch/end_patch=.
- Алиасы не поддерживаются в v1.


* Операции и версии
- "sre" v1 — 1..N пар FROM→TO в одном блоке =patch= (begin_from/begin_to).
- "aibo" v1 — literal-only поиск/замена (без регулярок) в одном блоке =patch= (begin_from/begin_to).
- "patch" v1 — unified diff одного файла в блоке =patch=.
- "create" v1 — создать файл (см. ./file-ops-v1.org).
- "replace" v1 — полностью заменить содержимое существующего файла (см. ./file-ops-v1.org).
- "delete" v1 — удалить файл (см. ./file-ops-v1.org).
- "rename" v1 — переименовать файл (см. ./file-ops-v1.org).

* Интерфейсы
- parse(op, header-plist, body-text, repo-root) → plan-item | error
- dry-run(plan-item, repo-root) → report
- apply(plan-item, repo-root) → result
- prompt-fragment(op, version) → STRING | FUNCTION (CTX → STRING)

* Эталонные символы (референсные имена функций)
- sre:
  - parse: carriage-parse-sre
  - dry-run: carriage-dry-run-sre
  - apply: carriage-apply-sre
- aibo:
  - parse: carriage-parse-aibo
  - dry-run: carriage-dry-run-aibo
  - apply: carriage-apply-aibo
- patch:
  - parse: carriage-parse-diff
  - dry-run/apply: через Apply Engine ('git) — см. ./apply-engines-v1.org
- create:
  - parse: carriage-parse-create
  - dry-run: carriage-dry-run-create
  - apply: carriage-apply-create
- delete:
  - parse: carriage-parse-delete
  - dry-run: carriage-dry-run-delete
  - apply: carriage-apply-delete
- rename:
  - parse: carriage-parse-rename
  - dry-run: carriage-dry-run-rename
  - apply: carriage-apply-rename
- replace:
  - parse: carriage-parse-replace
  - dry-run: carriage-dry-run-replace
  - apply: carriage-apply-replace

* Ошибки и совместимость
- Неизвестная :version или :op → отказ с кодом MODE_E_DISPATCH.
- Несоответствие имени блока → отказ (в v1 алиасы не поддерживаются).
- Логирование всех ошибок в единый канал диагностики.
- NOOP-политика: когда after == before, шаг применения возвращает статус 'skip (а не 'ok); отчёт включает :matches и, при наличии, :changed-bytes.
