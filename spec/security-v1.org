#+title: Security v1 — Политики безопасности
#+author: Peter Kosov <11111000000@email.com>
#+language: ru
#+options: toc:2 num:t

* Цели
- Предотвратить опасные изменения файловой системы и репозитория.
- Снизить риски из-за ошибок модели и некорректных патчей.

* Политика путей
- Только относительные пути внутри корня репозитория.
- Запрет абсолютных путей и переходов «..».
- Нормализация и проверка symlink-цепочек (deny-by-default при выходе за рабочее дерево).

* Ограничения форматов v1
- Бинарные патчи запрещены (patch).
- Только один файл на блок (patch), /dev/null для create/delete.
- Для SRE: :occur all → обязательное :expect; любые значения, кроме 'first|'all → SRE_E_OCCUR_VALUE.
- Для AIBO: регулярные выражения запрещены; ключ :match не допускается.
- TRAMP/remote: в v1 применение отключено (запрещено); необходимо проверять (file-remote-p) и отказывать.

* Git-операции
- Применение в ветке carriage/WIP.
- Запрет использования --unsafe-paths.
- Dry-run обязателен (SRE: симуляция замен; patch: git apply --check).

* EOL и кодировки
- Инструмент сохраняет исходный стиль EOL; принудительная нормализация в v1 не поддерживается. Исключение: при :op "create", если :ensure-final-newline=t — добавляется завершающая новая строка.
- Unicode-нормализация не выполняется.
- При смешанных EOL допускается предупреждение в отчёте dry-run.

* Ресурсные лимиты
- Нормативные значения лимитов: см. ./index.org (секция FREEZE).

* Трассировка и логи
- Логи действий с временем, путями и статусом; без отправки наружу.
- Опциональное сохранение сырого ответа LLM для воспроизводимости.

* Угрозы и смягчения
- Галлюцинации модели → строгая схема формата, валидаторы, отказ по умолчанию.
- Путь вне репозитория → отказ.
- Конфликты при применении → dry-run, предпросмотр, подтверждение, отказ при ошибке.
- Привилегии пользователя → операторы git выполняются в текущем окружении, без повышения привилегий.
