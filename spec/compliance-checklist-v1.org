#+title: Compliance Checklist v1 — Соответствие спецификациям
#+author: Peter Kosov <11111000000@email.com>
#+language: ru
#+options: toc:2 num:t
#+property: header-args :results silent

* Назначение
- Контрольный список для проверки соответствия реализации спецификациям v1.

* Форматы (обязательное)
- Блоки используют только =begin_patch/end_patch= (./parser-registry-v1.org).
- Поддержаны :op:
  - sre, sre-batch (./sre-v1.org)
  - patch (unified diff одного файла) (./patch-unified-diff-v1.org)
  - create/delete/rename (./file-ops-v1.org)
- Алисы блоков не поддерживаются — см. ./parser-registry-v1.org.


* Парсеры
- SRE-парсинг: см. ./sre-v1.org (детерминированный разбор по DELIM; без вложенных конструкций).
- Валидация путей: см. ./security-v1.org.
- PATCH: ограничения — см. ./patch-unified-diff-v1.org.
- MODE: алиасы :op запрещены (v1); опция carriage-mode-allow-op-aliases=nil по умолчанию; включение — режим совместимости (вне строгого v1).
- Ошибки: см. ./errors-v1.org (define-error и коды).

* Dry-run
- SRE: см. ./sre-v1.org (правила dry-run).
- PATCH: см. ./patch-unified-diff-v1.org (dry-run через git apply --check).
- FILE OPS: см. ./file-ops-v1.org (dry-run/валидация).

* Применение
- Порядок типов: delete → rename → create → patch → sre/sre-batch (./apply-pipeline-v1.org).
- Групповое применение: см. ./apply-pipeline-v1.org (остановка на первой ошибке; без авт. отката).
- Асинхронность: шаги выполняются неблокирующе; переходы по событиям движка; доступна отмена шага/пайплайна и таймауты.
- Синхронные обёртки (опционально): допускаются как тонкие адаптеры над движком для одиночных кейсов; UI не должен «замораживаться» дольше коротких ожиданий.
- Синхронные обёртки: отчёты включают :pid и :elapsed-ms (паритет с async).
- Движки: реализован выбор и реестр движков; по умолчанию используется 'git; ключ :apply в заголовке игнорируется.
- Коммиты: apply не выполняет commit; коммит — отдельные команды (carriage-commit-changes, carriage-commit-last-iteration); см. ./git-integration-v1.org.
- NOOP-политика: см. ./apply-pipeline-v1.org и ./api-v1.org (carriage-mode-sre-noop-on-zero-matches).

* UI/UX
- Клавиши и команды: см. ./ui-v1.org.
- Отчёты/предпросмотр/подтверждение: см. ./ui-v1.org.
- UI v1.1: в модлайне показывается только basename модели; tooltip [MODEL] содержит полный id backend[:provider]:model; все биндинги под C-c e через keyspec; меню C-c e (transient|fallback) — много-колоночная раскладка с заголовками групп (i18n), пункт :menu исключён; тумблеры [Ctx]/[Files] включены по умолчанию; уникализация клавиш: последний токен ("t c" → "c"), при коллизиях — base → UPPER → первая буква :id → цифры 1..9.
- I18N v1.1: слой локализации (./i18n-v1.org); все UI-строки (mode-line/header-line, кнопки, help-echo, which-key, заголовки transient) берутся по i18n-ключам; переключение локали обновляет подписи без глобальных побочных эффектов; fallback: ru → en → имя ключа.

* Безопасность
- Политики: см. ./security-v1.org (пути, EOL, запреты); лимиты — см. ./index.org (FREEZE).
- TRAMP/remote — см. ./security-v1.org (в v1 отключено).

* Промпты
- Интенты Ask/Patch и сьюиты из ./prompt-profiles-v1.org (Intent/Suite).
- Правила Intent=Patch: см. ./prompt-profiles-v1.org; имя блока/пути/DELIM — см. ./parser-registry-v1.org, ./security-v1.org, ./index.org (FREEZE).

* Тестирование
- Тесты: см. ./testing-v1.org (юниты, интеграция, golden files).

* Документация
- Обновлён ./index.org.
- Описаны коды ошибок и формат сообщений (./errors-v1.org).

* Подпись
- Версия реализации: v1
- Дата: 2025-10-27
- Ответственный: Carriage Team
